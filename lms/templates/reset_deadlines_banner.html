## mako

<%page expression_filter="h"/>
<%!
from django.utils.translation import ugettext as _

from lms.djangoapps.courseware.date_summary import CourseAssignmentDate
from course_modes.models import CourseMode
%>

% if on_dates_tab and not missed_deadlines:
    <div class="dates-banner">
        <div class="dates-banner-text">
            <strong>${_("We've built a suggested schedule to help you stay on track.")}</strong>
            ${_("But don't worry—it's flexible so you can learn at your own pace. If you happen to fall behind on our suggested dates, you'll be able to adjust them to keep yourself on track.")}
        </div>
    </div>
% endif
<%
has_locked_assignments = any(hasattr(block, 'contains_gated_content') and block.contains_gated_content for block in course_date_blocks if isinstance(block, CourseAssignmentDate)) if (course_date_blocks and on_dates_tab) else False
on_dates_tab_as_audit = on_dates_tab and enrollment_mode == CourseMode.AUDIT
on_dates_tab_as_verified = on_dates_tab and enrollment_mode == CourseMode.VERIFIED
not_on_dates_tab_as_audit = not on_dates_tab and enrollment_mode == CourseMode.AUDIT
not_on_dates_tab_as_verified = not on_dates_tab and enrollment_mode == CourseMode.VERIFIED
%>
% if ((on_dates_tab_as_audit and not has_locked_assignments) or (on_dates_tab_as_verified and missed_deadlines) or not_on_dates_tab_as_audit or not_on_dates_tab_as_verified):
    <div class="dates-banner">
        <div class="dates-banner-text banner-has-button">
            % if web_app_course_url:
                ${_("It looks like you've missed some important deadlines. Visit ")}
                <a href="${web_app_course_url}">${_("edx.org")}</a>
                ${_(" to reset your deadlines and get started today.")}
            % else:
                % if not_on_dates_tab_as_verified or (on_dates_tab_as_verified and missed_deadlines):
                    <strong>${_('It looks like you missed some important deadlines based on our suggested schedule.')}</strong>
                    ${_('To keep yourself on track, you can update this schedule and shift the past due assignments into the future. Don’t worry—you won’t lose any of the progress you’ve made when you shift your due dates.')}
                % endif
                % if (on_dates_tab_as_audit and not has_locked_assignments) or not_on_dates_tab_as_audit:
                    <strong>${_('You are auditing this course,')}</strong>
                    ${_(' which means that you are unable to participate in graded assignments.')}
                    % if on_dates_tab:
                        % if missed_deadlines:
                            ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today.')}
                        % else:
                            ${_(' To complete graded assignments as part of this course, you can upgrade today.')}
                        % endif
                    % else:
                         ${_(' It looks like you missed some important deadlines based on our suggested schedule. To complete graded assignments as part of this course and shift the past due assignments into the future, you can upgrade today.')}
                    % endif
                % endif
            % endif
        </div>
        % if not web_app_course_url:
            <div class="upgrade-button">
                % if not_on_dates_tab_as_verified or (on_dates_tab_as_verified and missed_deadlines):
                    <form method="post" action="${reset_deadlines_url}">
                        <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
                        <input type="hidden" name="reset_deadlines_redirect_url_base" value="${reset_deadlines_redirect_url_base}">
                        <input type="hidden" name="reset_deadlines_redirect_url_id_dict" value="${reset_deadlines_redirect_url_id_dict}">
                        <button class="btn reset-deadlines-button">${_("Reset my deadlines")}</button>
                    </form>
                % endif:
                % if (on_dates_tab_as_audit and not has_locked_assignments) or not_on_dates_tab_as_audit:
                    <a href="${verified_upgrade_link}">
                        <button type="button">
                            % if on_dates_tab:
                                % if missed_deadlines:
                                    ${_('Upgrade to shift due dates')}
                                % else:
                                    ${_('Upgrade now')}
                                % endif
                            % else:
                                ${_('Upgrade to shift due dates')}
                            % endif
                        </button>
                    </a>
                % endif
            </div>
        % endif
    </div>
% endif
